---

- name: Install LXQt packages
  ansible.builtin.apt:
    name: "{{ lxqt_packages }}"
    state: present
    install_recommends: false
  become: true

- name: Deploy .xinitrc
  ansible.builtin.template:
    src: xinitrc.j2
    dest: "/home/{{ username }}/.xinitrc"
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0644'

- name: Deploy .bash_profile
  ansible.builtin.template:
    src: bash_profile.j2
    dest: "/home/{{ username }}/.bash_profile"
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0644'

- name: Ensure override directory for getty@tty1 exists
  file:
    path: /etc/systemd/system/getty@tty1.service.d
    state: directory
    mode: '0755'

- name: Configure systemd autologin override for tty1
  ansible.builtin.template:
    src: getty-override.conf.j2
    dest: /etc/systemd/system/getty@tty1.service.d/override.conf
    mode: '0644'
  notify: Reload systemd

- name: Ensure lxqt config directory exists
  file:
    path: /home/{{ username }}/.config/lxqt/
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0755'

- name: Copy files to their destinations
  ansible.builtin.copy:
    src: "{{ item.Name }}"
    dest: "{{ item.Dest }}"
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0644'
  loop: "{{ files }}"

- name: Make 'less' default for opening text files
  ansible.builtin.command:
    cmd: xdg-mime default TextViewer.desktop text/plain

- name: Ensure pcmanfm-qt/lxqt config directory exists
  file:
    path: /home/{{ username }}/.config/pcmanfm-qt/lxqt/
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0755'

- name: Set visible desktop shortcuts
  ansible.builtin.ini_file:
    path: "/home/{{ username }}/.config/pcmanfm-qt/lxqt/settings.conf"
    section: "Desktop"
    option: "DesktopShortcuts"
    value: "Home"
    create: true
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0755'
